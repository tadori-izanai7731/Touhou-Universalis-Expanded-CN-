################################
##On Action Script
##############################
THE_FOM_on_startup_scripted_effects = {
	if = {
		limit = { 
			tag = MRS
			NOT = { has_country_flag = THE_MRS_on_startup_set_variable_flag }
		}
		country_event = {
			id = THE_FOM_flavor_events.1
		}
		#初始变量
		ENK = {
			set_variable = { which = the_fom_forest_influence_is_marisa_var value = 150 }
			set_variable = { which = the_fom_forest_influence_is_alice_var value = 15 }
			set_variable = { which = the_fom_forest_influence_is_our_var value = 15 }
		}
		#
		MST = {
			THE_FOM_on_start_random_list_set_influence_effects = {
				marisa = 25
				alice = 25
				us = 0
			}
		}
		#
		if = {
			limit = {
				MST = {
					check_variable = { which = the_fom_forest_influence_is_alice_var value = 50 }
				}
			}
			WRG = {
				THE_FOM_on_start_random_list_set_influence_effects = {
					marisa = 0
					alice = 25
					us = 0
				}
			}
		}
		else = {
			WRG = {
				THE_FOM_on_start_random_list_set_influence_effects = {
					marisa = 0
					alice = 0
					us = 25
				}
			}
		}
		set_country_flag = THE_MRS_on_startup_set_variable_flag
	}
	if = {
		limit = {
			OR = {
				tag = MRS
				tag = MGT
				tag = ENK
				tag = MST
				tag = WRG
			}
			NOT = { has_country_flag = THE_FOM_on_startup_set_variable_flag }
		}
		set_variable = {
			which = the_fom_check_won_rebel_im_var
			value = 0
		}
		set_country_flag = THE_FOM_on_startup_set_variable_flag
	}
	if = {
		limit = {
			tag = MGT
			NOT = { has_country_flag = THE_MGT_on_startup_set_variable_flag }
		}
		set_variable = {
			which = the_alc_dolls_manpower_pools_start
			value = 0
		}
		set_variable = {
			which = the_alc_dolls_manpower_pools_total
			value = 10000
		}
		set_variable = {
			which = the_alc_dolls_manpower_pools_max
			value = 10000
		}
		set_variable = {
			which = the_alc_dolls_manpower_pools_max_modifier
			value = 0
		}
		set_variable = {
			which = the_alc_dolls_manpower_pools_rescover_modifier
			value = 0
		}
		NOT = { has_country_flag = THE_MGT_on_startup_set_variable_flag }
	}
}

THE_FOM_on_start_random_list_set_influence_effects = {
	random_list = {
		$marisa$ = {
			set_variable = { which = the_fom_forest_influence_is_marisa_var value = 50 }
			set_variable = { which = the_fom_forest_influence_is_alice_var value = 30 }
			set_variable = { which = the_fom_forest_influence_is_our_var value = 30 }
		}
		$alice$ = {
			set_variable = { which = the_fom_forest_influence_is_marisa_var value = 30 }
			set_variable = { which = the_fom_forest_influence_is_alice_var value = 50 }
			set_variable = { which = the_fom_forest_influence_is_our_var value = 30 }
		}
		$us$ = {
			set_variable = { which = the_fom_forest_influence_is_marisa_var value = 30 }
			set_variable = { which = the_fom_forest_influence_is_alice_var value = 30 }
			set_variable = { which = the_fom_forest_influence_is_our_var value = 50 }
		}
	}
}

THE_FOM_won_rebel_im_var_effects = {
	if = {
		limit = {
			unit_owner = {
				th_is_or_was_tag = {
					tag = REB
				}
			}
			enemy_unit = {
				unit_owner = {
					OR = {
						tag = MRS
						tag = MGT
						tag = MST
						tag = WRG
						tag = ENK
						was_tag = MRS
						was_tag = MGT
					}
				}
			}
		}
		enemy_unit = {
			unit_owner = {
				change_variable = {
					which = the_fom_check_won_rebel_im_var
					value = 1
				}
			}
		}
	}
	if = {
		limit = { 
			enemy_unit = {
				unit_owner = {
					tag = MRS
					NOT = {
						has_country_flag = THE_FOM_won_rebel_im_var_effects_lock_flag
					}
					check_variable = {
						which = the_fom_check_won_rebel_im_var
						value = 2
					}
					NOT = {
						check_variable = {
							which = the_fom_check_won_rebel_im_var
							value = 3
						}
					}
				}
			}
		}
		enemy_unit = {
			unit_owner = {
				set_country_flag = THE_FOM_won_rebel_im_var_effects_lock_flag
				country_event = {
					id = THE_FOM_flavor_events.5
					days = 1
				}
			}
		}
	}
}
THE_FOM_won_youkai_enemy_leader_effects = {
	if = {
		limit = {
			ROOT = {
				tag = MRS
				was_tag = MRS
			}
			FROM = {
				has_country_flag = THE_FOM_desire_liberty_youkai_enemy_leader_flag
			}
		}
		country_event = {
			id = THE_FOM_flavor_events.33
		}
	}
	if = {
		limit = { 
			OR = {
				AND = {
					ROOT = {
						tag = MRS
						was_tag = MRS
					}
					FROM = {
						has_country_flag = THE_FOM_desire_liberty_youkai_enemy_leader_flag
					}
				}
				AND = {
					FROM = {
						tag = MRS
						was_tag = MRS
					}
					ROOT = {
						has_country_flag = THE_FOM_desire_liberty_youkai_enemy_leader_flag
					}
				}
			}
			NOT = {
				has_global_flag = THE_FOM_the_second_disaster_need_ended_flag
			}
		}
		ROOT = {
			clr_country_flag = THE_FOM_desire_liberty_youkai_enemy_leader_flag
		}
		FROM = {
			clr_country_flag = THE_FOM_desire_liberty_youkai_enemy_leader_flag
		}
		clr_global_flag = THE_FOM_disaster_second_start_flag
		set_global_flag = THE_FOM_the_second_disaster_need_ended_flag
	}
}

#######################
## OTHER SCRIPT
########################
THE_FOM_MGT_care_who_influence_by_her_effects = {
	if = {
		limit = {
			ENK = {
				has_country_flag = THE_FOM_youkai_region_desire_for_liberate
			}
		}
		custom_tooltip = THE_FOM_MGT_care_who_influence_by_her_effects_c_tt1
	}
	if = {
		limit = {
			MST = {
				has_country_flag = THE_FOM_youkai_region_desire_for_liberate
			}
		}
		custom_tooltip = THE_FOM_MGT_care_who_influence_by_her_effects_c_tt2
	}
	if = {
		limit = {
			WRG = {
				has_country_flag = THE_FOM_youkai_region_desire_for_liberate
			}
		}
		custom_tooltip = THE_FOM_MGT_care_who_influence_by_her_effects_c_tt3
	}
}
THE_FOM_care_who_desire_for_liberty_effects = {
	if = {
		limit = {
			ENK = {
				has_country_flag = THE_FOM_youkai_region_desire_for_liberate
			}
		}
		custom_tooltip = THE_FOM_care_who_desire_for_liberty_effects_c_tt1
	}
	if = {
		limit = {
			MST = {
				has_country_flag = THE_FOM_youkai_region_desire_for_liberate
			}
		}
		custom_tooltip = THE_FOM_care_who_desire_for_liberty_effects_c_tt2
	}
	if = {
		limit = {
			WRG = {
				has_country_flag = THE_FOM_youkai_region_desire_for_liberate
			}
		}
		custom_tooltip = THE_FOM_care_who_desire_for_liberty_effects_c_tt3
	}
}

THE_FOM_alice_give_tooltip_effects = {
	if = {
		limit = { 
			check_variable = {
				which = the_fom_check_error_in_forest_sounds_im_var
				value = 9
			}
		}
		custom_tooltip = THE_FOM_alice_give_tooltip_effects_c_tt1
	}
	else_if = {
		limit = {
			check_variable = {
				which = the_fom_check_error_in_forest_sounds_im_var
				value = 7
			}
		}
		custom_tooltip = THE_FOM_alice_give_tooltip_effects_c_tt2
	}
	else_if = {
		limit = {
			check_variable = {
				which = the_fom_check_error_in_forest_sounds_im_var
				value = 5
			}
		}
		custom_tooltip = THE_FOM_alice_give_tooltip_effects_c_tt3
	}
}

THE_FOM_fow_forest_error_option_effects = {
	hidden_effect = {
		change_variable = {
			which = the_fom_check_error_in_forest_sounds_im_var
			value = 1
		}
		country_event = {
			id = THE_FOM_flavor_events.25
			days = yes
		}
	}
}
THE_MGT_random_spawn_infantry_2_effects = {
	if = {
		limit = {
			mission_completed = THE_MGT_mission_5_4
		 }
		 THE_MGT_random_spawn_infantry_1_effects = yes
	}
	else = {
		mercenary_infantry = ROOT
	}
}
THE_MGT_random_spawn_infantry_1_effects = {
	owner = {
		change_variable = {
			which = THE_MGT_random_spawn_infantry_random_var
			value = 1
		}
	}
	if = {
		limit = { owner = { check_variable = { which = THE_MGT_random_spawn_infantry_random_var value = 9 } } }
		mercenary_infantry = ROOT
		owner = {
			set_variable = {
				which = THE_MGT_random_spawn_infantry_random_var
				value = 0
			}
		}
	}
	else_if = {
		limit = { owner = { check_variable = { which = THE_MGT_random_spawn_infantry_random_var value = 8 } } }
		cawa_infantry = ROOT
	}
	else_if = {
		limit = { owner = { check_variable = { which = THE_MGT_random_spawn_infantry_random_var value = 7 } } }
		cossack_infantry = ROOT
	}
	else_if = {
		limit = { owner = { check_variable = { which = THE_MGT_random_spawn_infantry_random_var value = 6 } } }
		rajput_infantry = ROOT
	}
	else_if = {
		limit = { owner = { check_variable = { which = THE_MGT_random_spawn_infantry_random_var value = 5 } } }
		carolean_infantry = ROOT
	}
	else_if = {
		limit = { owner = { check_variable = { which = THE_MGT_random_spawn_infantry_random_var value = 4 } } }
		tercio_infantry = ROOT
	}
	else_if = {
		limit = { owner = { check_variable = { which = THE_MGT_random_spawn_infantry_random_var value = 3 } } }
		samurai_infantry = ROOT
	}
	else_if = {
		limit = { owner = { check_variable = { which = THE_MGT_random_spawn_infantry_random_var value = 2 } } }
		streltsy_infantry = ROOT
	}
	else_if = {
		limit = { owner = { check_variable = { which = THE_MGT_random_spawn_infantry_random_var value = 1 } } }
		musketeer_infantry = ROOT
	}
}

THE_MGT_monthly_recovery_manpower_dolls_pool_effects = {
	if = {
		limit = {
			OR = {
				tag = MGT
				was_tag = MGT
			}
			has_government_attribute = enable_making_dolls_crops
			NOT = {
				check_variable = {
					which = the_alc_dolls_manpower_pools_total
					which = the_alc_dolls_manpower_pools_max
				}
			}
		}
		########运算
		#上限
		export_to_variable = {
			variable_name = the_alc_dolls_manpower_pools_max
			value = max_manpower
		}
		multiply_variable = {
			which = the_alc_dolls_manpower_pools_max
			value = 1000
		}
		divide_variable = {
			which = the_alc_dolls_manpower_pools_max
			value = 2
		}
		#导出上限
		export_to_variable = {
			variable_name = the_alc_dolls_manpower_pools_max_modifier
			value = modifier:THE_MGT_estate_dolls_pools_power
		}
		change_variable = {
			which = the_alc_dolls_manpower_pools_max_modifier
			value = 1
		}
		#上限 乘 修正
		multiply_variable = {
			which = the_alc_dolls_manpower_pools_max
			which = the_alc_dolls_manpower_pools_max_modifier
		}

		#####
		#回复
		export_to_variable = {
			variable_name = the_alc_dolls_manpower_pools_start
			value = max_manpower
		}
		multiply_variable = {
			which = the_alc_dolls_manpower_pools_start
			value = 1000
		}
		divide_variable = {
			which = the_alc_dolls_manpower_pools_start
			value = 4
		}
		#导出上限
		export_to_variable = {
			variable_name = the_alc_dolls_manpower_pools_max_modifier
			value = modifier:THE_MGT_estate_dolls_pools_power
		}
		change_variable = {
			which = the_alc_dolls_manpower_pools_max_modifier
			value = 1
		}
		#上限 乘 修正
		multiply_variable = {
			which = the_alc_dolls_manpower_pools_start
			which = the_alc_dolls_manpower_pools_max_modifier
		}
		divide_variable = {
			which = the_alc_dolls_manpower_pools_start
			value = 100
		}
		#####

		#导出回复
		export_to_variable = {
			variable_name = the_alc_dolls_manpower_pools_rescover_modifier
			value = modifier:THE_MGT_estate_dolls_pools_rescover
		}
		change_variable = {
			which = the_alc_dolls_manpower_pools_rescover_modifier
			value = 1
		}
		#回复 乘 修正
		multiply_variable = {
			which = the_alc_dolls_manpower_pools_start
			which = the_alc_dolls_manpower_pools_rescover_modifier
		}


		######
		change_variable = {
			which = the_alc_dolls_manpower_pools_total
			which = the_alc_dolls_manpower_pools_start
		}
	}

}

THE_MGT_on_battle_won_divide_manpower_effect = {
	if = {
		limit = { 
			tag = MGT
			has_government_attribute = THE_MGT_back_to_white_and_void_reform_mechanic
		}
		FROM = {
			export_to_variable = {
				variable_name = the_mgt_divide_enemy_manpower_won_battle_var
				who = MGT
				value = land_forcelimit
			}
			divide_variable = {
				which = the_mgt_divide_enemy_manpower_won_battle_var
				value = 10
			}
			while = {
				limit = {
					check_variable = {
						which = the_mgt_divide_enemy_manpower_won_battle_var
						value = 1
					}
				 }
				 add_manpower = -1
				 change_variable = {
					which = the_mgt_divide_enemy_manpower_won_battle_var
					value = -1
				 }
			}
		}
		
	}
}